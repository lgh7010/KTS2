<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.krafton.kts.backend.domain.action.service.impl.mybatis.ActionInterfaceMybatisMapper">
    <select id="findAction" resultType="com.krafton.kts.backend.domain.action.domain.db.KTS_ACTION">
        SELECT * FROM KTS_ACTION WHERE testcaseGuid = #{testcaseGuid} AND deleted = 'N'
    </select>

    <select id="getActionTemplate" resultType="com.krafton.kts.backend.domain.action.domain.db.KTS_ACTION_TEMPLATE">
        SELECT * FROM KTS_ACTION_TEMPLATE;
    </select>

    <update id="saveAction" parameterType="com.krafton.kts.backend.domain.action.domain.command.SaveActionCommand">
        INSERT INTO KTS_ACTION (actionGuid, testcaseGuid, isStart, nextActionGuid, actionId, x, y, description) VALUES
        <foreach item="item" index="index" collection="actionMap" separator=",">
            (#{item.actionGuid}, #{item.testcaseGuid}, #{item.isStart}, #{item.nextActionGuid}, #{item.actionId}, #{item.x}, #{item.y}, #{item.description})
        </foreach>;

        <if test="removeList != null and removeList.size() > 0">
            UPDATE KTS_ACTION SET deleted = 'Y' WHERE actionGuid IN
            <foreach item="item" index="index" collection="removeList" open="(" separator="," close=")">
                #{item}
            </foreach>;
        </if>
    </update>
</mapper>